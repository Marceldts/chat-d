
<ion-menu contentId="main-content" class="menu">
  <ion-header [translucent]="true">
    <ion-toolbar color="light">
      <ion-row>
        <ion-title class="ion-text-center">Menu</ion-title>
      </ion-row>
    </ion-toolbar>
  </ion-header>
  <ion-content class="ion-padding">
    <ion-list>
      <ion-item>
        <ion-text color="primary">Modo oscuro</ion-text>
        <ion-icon
          name="moon-outline"
          class="darkIcon"
          slot="end"
          *ngIf="darkTheme == 'true'"
        ></ion-icon>
        <ion-icon
          name="sunny-outline"
          class="darkIcon"
          slot="end"
          *ngIf="darkTheme == 'false'"
        ></ion-icon>
        <ion-toggle
          #themeToggle
          id="themeToggle"
          [checked]="darkTheme"
          slot="end"
        ></ion-toggle>
      </ion-item>
      <ion-item id="open-modal">
        <ion-text color="primary">Configuración</ion-text
        ><ion-icon name="settings-outline" slot="end"></ion-icon>
      </ion-item>
    </ion-list>
  </ion-content>
</ion-menu>

<ion-modal trigger="open-modal">
  <ng-template>
    <ion-header [translucent]="true">
      <ion-toolbar color="light">
        <ion-row>
          <ion-title class="ion-text-center">Configuración</ion-title>
        </ion-row>
      </ion-toolbar>
    </ion-header>
    <ion-content class="ion-padding">
      <ion-list>
        <ion-item>
          <ion-text color="primary">Modo oscuro</ion-text>
          <ion-icon
            name="moon-outline"
            class="darkIcon"
            slot="end"
            *ngIf="darkTheme == 'true'"
          ></ion-icon>
          <ion-icon
            name="sunny-outline"
            class="darkIcon"
            slot="end"
            *ngIf="darkTheme == 'false'"
          ></ion-icon>
          <ion-toggle
            #themeToggle
            id="themeToggle"
            [checked]="darkTheme"
            slot="end"
          ></ion-toggle>
        </ion-item>
        <ion-item>
          <ion-text color="primary">Tamaño de la fuente: </ion-text>
          <ion-select
            interface="popover"
            placeholder="{{ fontSize }}"
            (ionChange)="onSelectFontSize($event)"
          >
            <ion-select-option value="Pequeña">Pequeña</ion-select-option>
            <ion-select-option value="Normal">Normal</ion-select-option>
            <ion-select-option value="Grande">Grande</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-list>

      <ion-footer>
        <ion-toolbar>
          <div class="modalToolbar">
            <ion-buttons slot="start">
              <ion-button (click)="onCloseModal()">Cerrar</ion-button>
            </ion-buttons>
            <ion-buttons slot="end">
              <ion-button (click)="onSetDefaultValues()">Cargar valores por defecto</ion-button>
            </ion-buttons>
          </div>
        </ion-toolbar>
      </ion-footer>
    </ion-content>
  </ng-template>
</ion-modal>

<div class="ion-page" id="main-content"></div>
<ion-header [translucent]="true">
  <ion-toolbar color="light">
    <ion-row>
      <ion-menu-toggle class="menuBut">
        <ion-button fill="clear"
          ><ion-icon name="menu-outline" title="Menu"></ion-icon
        ></ion-button>
      </ion-menu-toggle>
      <ion-title class="ion-text-center">Chat</ion-title>
      <ion-button
        class="logoutBut"
        fill="clear"
        (click)="onLogoff()"
        title="Cerrar sesión"
      >
        <ion-icon name="log-out-outline"></ion-icon>
      </ion-button>
    </ion-row>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-content" onload="scrollOnInit()">
  <ion-infinite-scroll threshold="100px" (ionInfinite)="loadData($event)">
    <ion-infinite-scroll-content
      loadingSpinner="bubbles"
      loadingText="Cargando más mensajes..."
    >
      <div
        *ngFor="let message of messages | slice: ind:messages.length"
        [ngClass]="message.user === user ? 'flex' : 'other'"
      >
        <div class="own">
          <ion-row class="headMsg">
            <ion-text
              ><b>{{ message.user }}:</b><br
            /></ion-text>
            <!-- Probar a poner el span con el pointer events none en el css del icon (aunque no creo que funcione) -->
            <span
              title="Borrar mensaje"
              class="del2"
              (click)="onDelete(message)"
            >
              <ion-icon name="trash-outline" class="del" item-right></ion-icon
            ></span>
          </ion-row>
          <ion-label class="ion-text-wrap" *ngIf="message.type === 'txt'">
            {{ message.text }}
          </ion-label>
          <img
            src="{{ message.text }}"
            *ngIf="message.type === 'img'"
            class="img"
          />
        </div>
      </div>
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-row>
      <ion-input
        type="text"
        placeholder="Escribe aquí"
        minlength="1"
        id="inputMessage"
        (keyup.enter)="onSendMessage()"
      ></ion-input>
      <ion-button fill="clear" (click)="onTakePicture()" class="camera">
        <ion-icon slot="icon-only" name="camera-outline"></ion-icon>
      </ion-button>
      <ion-button fill="clear" (click)="onSendMessage()" class="enviar">
        <ion-icon name="send-outline"></ion-icon>
      </ion-button>
    </ion-row>
  </ion-toolbar>
</ion-footer>
